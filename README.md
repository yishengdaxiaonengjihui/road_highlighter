# ä¸­å›½å›½çœé“è·¯ç½‘é«˜äº®æ ‡æ³¨å·¥å…·

ä¸€é”®ç”ŸæˆæŒ‡å®šåŒºåŸŸçš„ä¸­å›½å›½é“(G)å’Œçœé“(S)è·¯ç½‘åœ°å›¾ï¼Œé«˜äº®æ˜¾ç¤ºæŒ‡å®šé‡ç‚¹é“è·¯ã€‚

**é€šç”¨æ€§**ï¼šå¯ç”¨äºä¸­å›½ä»»æ„åŒºåŸŸï¼Œåªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `bbox` å’Œ `target_roads`ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸŒ æ”¯æŒä»»æ„ä¸­å›½åŒºåŸŸï¼ˆé€šè¿‡è¾¹ç•Œæ¡† bboxï¼‰
- ğŸ¯ çµæ´»é…ç½®é«˜äº®é“è·¯ï¼ˆå›½é“ Gã€çœé“ S ç¼–å·ï¼‰
- ğŸ—ºï¸ è‡ªåŠ¨ä¸‹è½½å®Œæ•´è·¯ç½‘ä½œä¸ºèƒŒæ™¯ï¼Œå åŠ é«˜äº®å›¾å±‚
- ğŸ¨ æ™ºèƒ½é…è‰²ï¼Œå›¾ä¾‹è‡ªåŠ¨æ ‡æ³¨é“è·¯åç§°
- ğŸ“¤ è¾“å‡ºé«˜æ¸… SVG çŸ¢é‡åœ°å›¾
- âš™ï¸ çº¯é…ç½®åŒ–æ“ä½œï¼Œæ— éœ€ä¿®æ”¹ä»£ç 

## é¡¹ç›®ç»“æ„

```
road_highlighter/
â”œâ”€â”€ generate_map.py         # ä¸»ç¨‹åºï¼šç”Ÿæˆåœ°å›¾
â”œâ”€â”€ prepare_map.py          # å¯é€‰ï¼šä» PBF æå– OSM XMLï¼ˆå¤‡ç”¨ï¼‰
â”œâ”€â”€ map/                    # å­˜æ”¾ç¦»çº¿åœ°å›¾æ•°æ®ï¼ˆPBF æ–‡ä»¶ï¼‰
â”œâ”€â”€ config.example.yaml     # é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆä¸Šæµ·ï¼‰
â”œâ”€â”€ config.yaml             # ä½ çš„ä¸ªäººé…ç½®ï¼ˆéœ€è‡ªè¡Œåˆ›å»ºï¼‰
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ data/                   # è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆ
â”‚   â””â”€â”€ outputs/           # è¾“å‡ºåœ°å›¾ï¼ˆSVG/PNGï¼‰
â””â”€â”€ README.md
```

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ä¾èµ–åº“ï¼š`osmnx`, `matplotlib`, `geopandas`, `pyyaml`, `pyrosm`

### ç³»ç»Ÿä¾èµ–ï¼ˆLinux/macOSï¼‰

```bash
# Ubuntu/Debian
sudo apt-get install libspatialindex-dev gdal-bin libgdal-dev

# macOS (with Homebrew)
brew install spatialindex gdal
```

Windows æ¨èä½¿ç”¨ [Anaconda](https://www.anaconda.com/) å®‰è£…ä¾èµ–ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å‡†å¤‡åœ°å›¾æ•°æ®ï¼ˆäºŒé€‰ä¸€ï¼‰

**æ–¹æ¡ˆ Aï¼šOSM åœ¨çº¿ä¸‹è½½**ï¼ˆéœ€è¦ç½‘ç»œï¼‰

- æ— éœ€å‡†å¤‡æ•°æ®ï¼Œç¨‹åºä¼šè‡ªåŠ¨ä¸‹è½½ã€‚

**æ–¹æ¡ˆ Bï¼šOSM ç¦»çº¿ PBF**ï¼ˆæ¨èæ— ç½‘ç»œç¯å¢ƒï¼‰

1. ä¸‹è½½å¯¹åº”åŒºåŸŸçš„ `.osm.pbf` æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š
   - ä¸Šæµ·ï¼šä» [Geofabrik](https://download.geofabrik.de/asia/china.html) ä¸‹è½½ `shanghai-latest.osm.pbf`
2. å°†æ–‡ä»¶æ”¾å…¥ `map/` ç›®å½•ï¼Œå¦‚ `map/shanghai-latest.osm.pbf`
3. åœ¨ `config.yaml` ä¸­è®¾ç½® `pbf_path: "map/shanghai-latest.osm.pbf"`

### 3. é…ç½® `config.yaml`

å¤åˆ¶ç¤ºä¾‹é…ç½®å¹¶ä¿®æ”¹ï¼š

```bash
cp config.example.yaml config.yaml
```

ç„¶åç¼–è¾‘ `config.yaml`ï¼Œå…³é”®å‚æ•°ï¼š

| å‚æ•°             | è¯´æ˜                               | ç¤ºä¾‹                                         |
| -------------- | -------------------------------- | ------------------------------------------ |
| `pbf_path`     | æœ¬åœ° PBF æ–‡ä»¶è·¯å¾„ï¼ˆç¦»çº¿æ¨¡å¼ï¼‰                | `"map/shanghai-latest.osm.pbf"`            |
| `place`        | åœ°åï¼ˆåœ¨çº¿æ¨¡å¼ï¼Œè‹±æ–‡ï¼‰                      | `"Shanghai, China"`                        |
| `bbox`         | è¾¹ç•Œæ¡† `[south, west, north, east]` | `[31.1, 121.0, 31.9, 122.2]`               |
| `target_roads` | è¦é«˜äº®æ˜¾ç¤ºçš„é“è·¯ç¼–å·åˆ—è¡¨                     | `["G40", "G50", "G60"]`                    |
| `road_names`   | é“è·¯åç§°æ˜ å°„ï¼ˆå›¾ä¾‹æ˜¾ç¤ºï¼‰                     | `{G40: "æ²ªé™•é«˜é€Ÿ", G50: "æ²ªæ¸é«˜é€Ÿ"}`               |
| `output`       | è¾“å‡ºæ–‡ä»¶è·¯å¾„                           | `"data/outputs/shanghai_road_network.svg"` |
| `title`        | åœ°å›¾æ ‡é¢˜                             | `"ä¸Šæµ·å¸‚å›½çœé“è·¯ç½‘å›¾"`                              |

**æ³¨æ„**ï¼š`pbf_path` å’Œ `place` äºŒé€‰ä¸€å³å¯ã€‚å¦‚æœæä¾› `pbf_path`ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ç¦»çº¿æ–‡ä»¶ï¼›å¦åˆ™å°è¯•åœ¨çº¿ä¸‹è½½ï¼ˆéœ€ `bbox` æˆ– `place`ï¼‰ã€‚

### 4. è¿è¡Œ

```bash
python generate_map.py --config config.yaml
```

### 5. æŸ¥çœ‹ç»“æœ

åœ°å›¾ä¿å­˜åœ¨ `data/outputs/` ç›®å½•ï¼Œæ–‡ä»¶åç”± `output` å‚æ•°æŒ‡å®šã€‚

## é»˜è®¤é…ç½®ç¤ºä¾‹ï¼ˆä¸Šæµ·ï¼‰

`config.example.yaml` å·²é…ç½®ä¸ºä¸Šæµ·å¸‚ç¤ºä¾‹ï¼š

- bbox: `[31.1, 121.0, 31.9, 122.2]`
- target_roads: `["G40", "G50", "G60", "G1503", "S1", "S2", "S20", "S30"]`
- output: `data/outputs/shanghai_road_network.svg`

å¦‚éœ€ç”Ÿæˆå…¶ä»–åŸå¸‚ï¼Œä¿®æ”¹ `bbox` å’Œ `target_roads` å³å¯ã€‚

## å¸¸è§é—®é¢˜

**Q: é«˜äº®é“è·¯ä¸æ˜¾ç¤ºï¼Ÿ**
A: æ£€æŸ¥ OSM ä¸­è¯¥é“è·¯æ˜¯å¦æœ‰ `ref` æ ‡ç­¾ã€‚è®¿é—® [OpenStreetMap.org](https://www.openstreetmap.org) æœç´¢é“è·¯ï¼ŒæŸ¥çœ‹å±æ€§ä¸­æ˜¯å¦æœ‰ `ref=GXXX`ã€‚è‹¥æ— ï¼Œåˆ™æ— æ³•ç­›é€‰ã€‚

**Q: ä¸‹è½½è¶…æ—¶æˆ–å†…å­˜ä¸è¶³ï¼Ÿ**
A: åŒºåŸŸå¤ªå¤§å¯¼è‡´æ•°æ®é‡è¿‡å¤§ã€‚ç¼©å° `bbox` èŒƒå›´ï¼Œæˆ–åªä¸‹è½½ `drive` ç±»å‹é“è·¯ï¼ˆä»£ç å·²é»˜è®¤ï¼‰ã€‚

**Q: ä½¿ç”¨ PBF ç¦»çº¿æ¨¡å¼æŠ¥é”™ï¼Ÿ**
A: ç¡®ä¿å·²å®‰è£… `pyrosm`ï¼š`pip install pyrosm`ã€‚ç¡®è®¤ PBF æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”æ–‡ä»¶å®Œæ•´ã€‚

**Q: èƒŒæ™¯é“è·¯å¤ªå¤šå¤ªæ‚ä¹±ï¼Ÿ**
A: åœ¨ `generate_map.py` ä¸­å¯è°ƒæ•´ `allowed_highways` é›†åˆï¼Œåªä¿ç•™éœ€è¦çš„é“è·¯ç­‰çº§ï¼ˆå¦‚ `{"trunk", "primary", "secondary"}`ï¼‰ã€‚

## æŠ€æœ¯æ ˆ

- **æ•°æ®æº**: OpenStreetMap (OSM)
- **åœ¨çº¿ä¸‹è½½**: [OSMnx](https://github.com/gboeing/osmnx)
- **ç¦»çº¿ PBF**: [pyrosm](https://github.com/HTenkanen/pyrosm)
- **ç­›é€‰**: é€šè¿‡ `edges["ref"].isin(target_roads)` åŒ¹é…é“è·¯ç¼–å·
- **ç»˜å›¾**: Matplotlib + GeoPandasï¼Œè¾“å‡º SVG

---

**MIT License**

---

*AI-generated*